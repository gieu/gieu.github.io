---
// import { Image } from "astro:assets";

import brand from "../../assets/img/brand/brand_dark.svg";

import HeaderLink from "./HeaderLink.astro";
---

<header>
    <div id="main-header" class="px-5 sm:px-20">
        <div id="brand" class="flex">
            <a href="/" class="brand-link group">
                <img
                    src={brand.src}
                    alt="Grupo de Investigación en informática educativa"
                    width={180}
                    loading="eager"
                    decoding="async"
                    class="h-12 w-auto transition-all duration-300 group-hover:scale-105"
                />
                <div class="brand-glow"></div>
            </a>
        </div>
        
        <!-- Desktop Navigation -->
        <nav class="hidden sm:flex flex-row justify-center sm:justify-end gap-2">
            <HeaderLink href="/">Inicio</HeaderLink>
            <HeaderLink href="/team">Equipo</HeaderLink>
            <HeaderLink href="/projects">Proyectos</HeaderLink>
            <HeaderLink href="/research">Investigación</HeaderLink>
        </nav>
        
        <!-- Mobile Menu Button -->
        <div class="sm:hidden flex justify-end">
            <button 
                id="mobile-menu-btn" 
                class="flex flex-col justify-center items-center w-8 h-8 space-y-1 group"
                aria-label="Abrir menú de navegación"
            >
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
        </div>
    </div>
    
    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="mobile-menu-overlay">
        <div class="mobile-menu-content">
            <nav class="flex flex-col space-y-4">
                <a href="/" class="mobile-nav-link">Inicio</a>
                <a href="/team" class="mobile-nav-link">Equipo</a>
                <a href="/projects" class="mobile-nav-link">Proyectos</a>
                <a href="/research" class="mobile-nav-link">Investigación</a>
            </nav>
        </div>
    </div>
    
    <!-- Header Background Animation -->
    <div class="header-bg-animation"></div>

    <style>
        #main-header {
            @apply py-4;
            @apply text-cod_gray-950;
            @apply w-full h-fit;
            @apply fixed top-0 left-0 right-0 z-50;
            @apply grid grid-cols-2 items-center;
            @apply transition-all duration-300;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(203, 213, 225, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        /* Header scroll effect */
        #main-header.scrolled {
            @apply py-2;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            border-bottom: 1px solid rgba(203, 213, 225, 0.6);
            transform: translateY(-1px);
        }

        #main-header.scrolled img {
            @apply h-10;
        }

        #main-header.scrolled .brand-glow {
            @apply opacity-30;
        }
        
        #brand {
            @apply justify-center sm:justify-start;
        }

        /* Brand improvements */
        .brand-link {
            @apply relative block;
            @apply transition-all duration-300;
        }

        .brand-glow {
            @apply absolute inset-0;
            @apply opacity-0 transition-opacity duration-300;
            background: radial-gradient(circle, rgba(168, 85, 247, 0.2) 0%, transparent 70%);
            border-radius: 50%;
            transform: scale(1.5);
            z-index: -1;
        }

        .brand-link:hover .brand-glow {
            @apply opacity-100;
        }

        /* Mobile menu button */
        #mobile-menu-btn {
            @apply relative transition-all duration-300;
            @apply hover:scale-110;
        }

        .hamburger-line {
            @apply w-6 h-0.5 bg-cod_gray-800;
            @apply transition-all duration-300 ease-in-out;
            @apply origin-center;
        }

        #mobile-menu-btn:hover .hamburger-line {
            @apply bg-Shiraz-600;
        }

        #mobile-menu-btn.active .hamburger-line:nth-child(1) {
            transform: rotate(45deg) translate(4px, 4px);
        }

        #mobile-menu-btn.active .hamburger-line:nth-child(2) {
            opacity: 0;
            transform: scale(0);
        }

        #mobile-menu-btn.active .hamburger-line:nth-child(3) {
            transform: rotate(-45deg) translate(4px, -4px);
        }

        /* Mobile menu overlay */
        .mobile-menu-overlay {
            @apply fixed inset-0 z-40;
            @apply bg-black/50 backdrop-blur-sm;
            @apply transition-all duration-300;
            @apply opacity-0 pointer-events-none;
            @apply sm:hidden;
        }

        .mobile-menu-overlay.active {
            @apply opacity-100 pointer-events-auto;
        }

        .mobile-menu-content {
            @apply absolute top-0 right-0 h-full w-80 max-w-[80vw];
            @apply bg-white/95 backdrop-blur-md;
            @apply border-l border-cod_gray-200/50;
            @apply p-6 pt-20;
            @apply transform translate-x-full transition-transform duration-300;
            @apply shadow-2xl;
        }

        .mobile-menu-overlay.active .mobile-menu-content {
            @apply transform translate-x-0;
        }

        .mobile-nav-link {
            @apply block px-4 py-3 text-lg font-medium;
            @apply text-cod_gray-800 hover:text-Shiraz-600;
            @apply border-l-4 border-transparent hover:border-Shiraz-500;
            @apply transition-all duration-300;
            @apply hover:bg-Shiraz-50 hover:transform hover:translate-x-2;
        }

        /* Header background animation */
        .header-bg-animation {
            @apply absolute inset-0 opacity-20 pointer-events-none;
            background: linear-gradient(-45deg, transparent 0%, rgba(168, 85, 247, 0.1) 25%, transparent 50%, rgba(236, 72, 153, 0.1) 75%, transparent 100%);
            background-size: 200% 200%;
            animation: gradientShift 8s ease infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Pulse effect on brand */
        .brand-link::after {
            content: '';
            @apply absolute inset-0 rounded-full;
            @apply opacity-0 scale-50;
            @apply transition-all duration-500;
            background: radial-gradient(circle, rgba(168, 85, 247, 0.3) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 0; 
                transform: scale(0.8); 
            }
            50% { 
                opacity: 0.3; 
                transform: scale(1.2); 
            }
        }

        /* Floating animation for header */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-2px); }
        }

        #main-header:hover {
            animation: float 2s ease-in-out infinite;
        }

        /* Responsive mejoras */
        @media (max-width: 640px) {
            #main-header {
                @apply grid-cols-2 py-3;
                @apply gap-0;
            }
            
            #brand {
                @apply justify-start;
            }

            /* Asegurar que el botón del menú esté pegado al borde derecho */
            .sm\\:hidden {
                @apply justify-end pr-0;
            }
        }

        /* Agregar padding al body para compensar el header fijo */
        :global(body) {
            padding-top: 80px;
            transition: padding-top 0.3s ease;
        }

        @media (max-width: 640px) {
            :global(body) {
                padding-top: 76px;
            }
        }

        /* Scroll indicator mejorado */
        #main-header::before {
            content: '';
            @apply absolute bottom-0 left-0 h-1;
            @apply bg-gradient-to-r from-Shiraz-500 via-daisy_bush-500 to-Shiraz-500;
            @apply transition-all duration-500 ease-out;
            width: var(--scroll-progress, 0%);
            box-shadow: 0 0 10px rgba(168, 85, 247, 0.5);
            z-index: 10;
        }

        #main-header.scrolled::before {
            @apply h-0.5;
            box-shadow: 0 0 8px rgba(168, 85, 247, 0.7);
        }

        /* Añadir una sombra más dramática al hacer scroll */
        #main-header.scrolled {
            box-shadow: 
                0 10px 40px rgba(0, 0, 0, 0.15),
                0 0 0 1px rgba(255, 255, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        /* Glitch effect on hover (sutil) */
        .brand-link:hover img {
            animation: glitch 0.3s ease-in-out;
        }

        @keyframes glitch {
            0%, 100% { transform: translate(0); }
            20% { transform: translate(-1px, 1px); }
            40% { transform: translate(1px, -1px); }
            60% { transform: translate(-1px, -1px); }
            80% { transform: translate(1px, 1px); }
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const header = document.getElementById('main-header');
            
            // Header scroll effect mejorado
            function handleScroll() {
                if (!header) return;
                
                const scrollY = window.scrollY;
                const scrollThreshold = 20; // Reducido para activación más temprana
                
                if (scrollY > scrollThreshold) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
                
                // Scroll progress indicator
                const scrolled = (scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
                header.style.setProperty('--scroll-progress', `${Math.min(scrolled, 100)}%`);
            }
            
            // Usar requestAnimationFrame para mejor performance
            let ticking = false;
            window.addEventListener('scroll', () => {
                if (!ticking) {
                    requestAnimationFrame(() => {
                        handleScroll();
                        ticking = false;
                    });
                    ticking = true;
                }
            });

            // Mobile menu toggle
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');

            mobileMenuBtn?.addEventListener('click', (e) => {
                e.preventDefault();
                mobileMenuBtn.classList.toggle('active');
                mobileMenu?.classList.toggle('active');
                
                // Prevenir scroll del body cuando el menú está abierto
                if (mobileMenu?.classList.contains('active')) {
                    document.body.style.overflow = 'hidden';
                } else {
                    document.body.style.overflow = '';
                }
            });

            // Close mobile menu when clicking overlay
            mobileMenu?.addEventListener('click', (e) => {
                if (e.target === mobileMenu) {
                    mobileMenuBtn?.classList.remove('active');
                    mobileMenu.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });

            // Close mobile menu on navigation
            document.querySelectorAll('.mobile-nav-link').forEach(link => {
                link.addEventListener('click', () => {
                    mobileMenuBtn?.classList.remove('active');
                    mobileMenu?.classList.remove('active');
                    document.body.style.overflow = '';
                });
            });

            // Cerrar menú con tecla Escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && mobileMenu?.classList.contains('active')) {
                    mobileMenuBtn?.classList.remove('active');
                    mobileMenu.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });

            // Ejecutar handleScroll una vez al cargar para estado inicial
            handleScroll();
        });
    </script>
</header>
